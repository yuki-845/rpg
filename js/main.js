const canvas = document.getElementById("myCanvas");
        

const ctx = canvas.getContext("2d");
let map = [
['～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '～', '～', '～', '～', '～', '～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', '・', '・', '・', '・', '・', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '・', '・', '・', '～', '～', '～', '～', '～', '～', '～', '～', '・', '・', '・', '・', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', '　', '橋', '橋', '橋', '橋', '橋', '橋', '橋', '橋', '　', '　', '　', '　', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '・', '　', '　', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '・', '　', '　', '　', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', '　', '・', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', '　', '　', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '・', '・', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '・', '・', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '・', '・', '・', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', '　', '　', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '・', '・', '・', 'Ｍ', '・', '　', '　', '　', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '・', '魔', '○', '○', 'Ｍ', '・', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', '・', 'Ｍ', '・', '・', '・', '・', 'Ｍ', '・', '○', '○', '○', 'Ｍ', '・', '　', '　', '　', '・', '・', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', '　', 'Ｍ', '・', '城', '○', '○', 'Ｍ', '・', '○', '○', '○', 'Ｍ', '・', '　', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', '　', 'Ｍ', '・', '○', '○', '○', 'Ｍ', 'Ｍ', '・', '　', '　', 'Ｍ', '・', '　', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', '　', 'Ｍ', '・', '○', '○', '○', 'Ｍ', 'Ｍ', '・', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', '　', 'Ｍ', '・', '　', '　', '　', 'Ｍ', 'Ｍ', '・', '　', '　', '・', '・', '・', '・', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', '山', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', '　', 'Ｍ', '・', '　', '　', '　', '　', '　', '　', '　', '　', '　', '　', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', '・', '　', '　', '　', '・', '・', '　', '　', '　', '　', '　', '　', '　', '　', '　', '　', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', '・', '　', '　', '　', '　', '　', '　', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', 'Ｍ', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', '・', '・', '・', '・', '・', '・', '・', '・', '・', '・', '・', '・', '・', '・', '・', '・', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
['～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～', '～'],
]

const player = new Image(32,32);
player.src = "img/player.png";
let Noright = false;
let Noleft = false;
let Nodown = false;
let Noup = false;
        let playerX = 0;
        let playerY = 0;
        const playerSpeed = 6;

        function drawPlayer() {
            
            ctx.drawImage(player, 0, 0);
        }
        function drawMap() {
            let wall = new Image(32,32);
            wall.src = "img/wall.png";
            
            for (var y=0; y<map.length; y++) {
                
                for (var x=0; x<map[y].length; x++) {
                    
                    if ( map[y][x] === 'Ｍ' )  {
                    ctx.drawImage( wall, 32*x - playerX, 32*y - playerY);
                    
                    }
                }
                
            }
            
        }
        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawMap();
            drawPlayer();
        }

        function keyDownHandler(event) {
            switch (event.key) {
                case "ArrowUp":
                    let a = false;
                    for (var y=0; y<map.length; y++) {
                
                        for (var x=0; x<map[y].length; x++) {
                            
                            let P = playerY - playerSpeed;
                            if(map[y][x] === 1) {
                                
                                if(32*x - playerX > -28 && 32*x - playerX< 32 && 32*y - P <= -6 && 32*y - P >= -32) {
                                    console.log(32*x - playerX, 32*y - playerY,x,y)
                                    a = true
                                }
                                
                            }
                            
                        }
                        
                    }
                    if(a) break;
                    playerY -= playerSpeed;
                    break;
                case "ArrowDown":
                    let b = false;
                    for (var y=0; y<map.length; y++) {
                
                        for (var x=0; x<map[y].length; x++) {
                            
                            let P = playerY + playerSpeed;
                            if(map[y][x] === 1) {
                                
                                if(32*x - playerX > -28 && 32*x - playerX< 32 && 32*y - P <= 28 && 32*y - P >= 16) {
                                    
                                    b = true
                                }
                                
                            }
                            
                        }
                        
                    }
                    if(b) break;
                    playerY += playerSpeed;
                    break;
                case "ArrowLeft":
                    let c = false;
                    for (var y=0; y<map.length; y++) {
                
                        for (var x=0; x<map[y].length; x++) {
                            
                            let P = playerX + playerSpeed;
                            if(map[y][x] === 1) {
                                if(32*y - playerY > -28 && 32*y - playerY < 32 && 32*x - P <= -28 && 32*x - P >= -40) {
                                    c = true;
                                    
                                }
                               
                                
                                
                            }
                            
                        }
                        
                    }
                    if(c) break;
                    playerX -= playerSpeed;
                    break;
                case "ArrowRight":
                    let d = false;
                    for (var y=0; y<map.length; y++) {
                
                        for (var x=0; x<map[y].length; x++) {
                            
                            let P = playerX - playerSpeed;
                            if(map[y][x] === 1) {
                                if(32*y - playerY > -28 && 32*y - playerY < 32 && 32*x - P >= 32 && 32*x - P <= 40) {
                                    d = true;
                                    
                                }
                                if(32*y - playerY > -28 && 32*y - playerY < 32) {
                                    console.log(32*x - P,32*y - playerY,x,y)
                                }
                                
                                
                            }
                            
                        }
                        
                    }
                    if(d) break;
                    playerX += playerSpeed;
                    break;
            }
        }

        document.addEventListener("keydown", keyDownHandler);

        function gameLoop() {
            update();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();